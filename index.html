<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Golf Bet Calculator</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  .num-input-wrapper {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
  }
  .num-input-wrapper button {
    width: 30px;
    height: 30px;
    font-size: 18px;
    line-height: 18px;
    padding: 0;
    user-select: none;
    cursor: pointer;
  }
  .num-input-wrapper input[type=number] {
    width: 50px;
    text-align: center;
    font-size: 18px;
    padding: 5px 4px;
  }
  label { margin-left: 10px; }
  #playerInputs div {
    margin-bottom: 10px;
  }
  #game { display: none; }
  #scoreInputs div {
    margin-bottom: 8px;
  }
  button {
    cursor: pointer;
  }
</style>
</head>
<body>

<div class="setup">
  <h2>Golf Bet Setup</h2>

  <div class="num-input-wrapper">
    <button onclick="adjustValue('playerCount', -1)">−</button>
    <input id="playerCount" type="number" min="2" max="6" value="4" />
    <button onclick="adjustValue('playerCount', 1)">+</button>
    <label>Number of Players</label>
  </div>

  <div class="num-input-wrapper">
    <button onclick="adjustValue('skinValue', -1)">−</button>
    <input id="skinValue" type="number" min="1" value="5" />
    <button onclick="adjustValue('skinValue', 1)">+</button>
    <label>Skin Value ($)</label>
  </div>

  <br />

  <button id="nextBtn">Next</button>

  <div id="playerInputs" style="margin-top:20px;"></div>

  <button id="startBtn" style="display:none; margin-top:10px;">Start Game</button>
</div>

<div id="game">
  <h2>Hole <span id="holeNum">1</span> / 18</h2>
  <div id="scoreInputs"></div>
  <button onclick="prevHole()">← Prev Hole</button>
  <button onclick="nextHole()">Next Hole →</button>
  <h3>Total Earnings</h3>
  <ul id="earningsList"></ul>
</div>

<script>
  let players = [];
  let handicaps = {};
  let scores = {};
  let bonusData = {};
  let penaltyData = {};
  let currentHole = 1;
  let skinValue = 5;

  function adjustValue(id, delta) {
    const input = document.getElementById(id);
    let val = parseInt(input.value || '0');
    val += delta;
    if (id === 'playerCount') {
      val = Math.max(2, Math.min(6, val));
    } else if (id === 'skinValue') {
      val = Math.max(1, val);
    }
    input.value = val;
  }

  // When Next clicked: show player name and handicap inputs
  document.getElementById('nextBtn').addEventListener('click', () => {
    const count = parseInt(document.getElementById('playerCount').value);
    const container = document.getElementById('playerInputs');
    container.innerHTML = '';
    for(let i=0; i < count; i++) {
      container.innerHTML += `
        <div>
          <label>Player ${i+1} Name: <input id="pname${i}" /></label>
          <label style="margin-left:10px;">Handicap: <input id="phcap${i}" type="number" min="0" /></label>
        </div>
      `;
    }
    document.getElementById('startBtn').style.display = 'inline-block';
  });

  // When Start Game clicked: initialize all arrays and show game section
  document.getElementById('startBtn').addEventListener('click', () => {
    skinValue = parseFloat(document.getElementById('skinValue').value) || 5;
    const count = parseInt(document.getElementById('playerCount').value);

    players = [];
    handicaps = {};
    scores = {};
    bonusData = {};
    penaltyData = {};

    for(let i=0; i < count; i++){
      const name = document.getElementById(`pname${i}`).value.trim() || `Player ${i+1}`;
      const hcap = parseInt(document.getElementById(`phcap${i}`).value) || 0;
      players.push(name);
      handicaps[name] = hcap;
      scores[name] = Array(18).fill(0);
      bonusData[name] = Array(18).fill(0);
      penaltyData[name] = Array(18).fill(0);
    }

    currentHole = 1;

    document.querySelector('.setup').style.display = 'none';
    document.getElementById('game').style.display = 'block';

    renderHole();
  });

  function renderHole(){
    document.getElementById('holeNum').textContent = currentHole;

    const container = document.getElementById('scoreInputs');
    container.innerHTML = '';

    players.forEach(name => {
      const stroke = scores[name][currentHole - 1];
      const bonus = bonusData[name][currentHole - 1];
      const penalty = penaltyData[name][currentHole - 1];

      container.innerHTML += `
        <div>
          <strong>${name}</strong><br/>
          Strokes 
          <button onclick="changeScore('${name}', -1)">−</button>
          <span>${stroke}</span>
          <button onclick="changeScore('${name}', 1)">+</button>
          &nbsp;&nbsp;
          Bonus 
          <button onclick="changeBonus('${name}', -1)">−</button>
          <span>${bonus}</span>
          <button onclick="changeBonus('${name}', 1)">+</button>
          &nbsp;&nbsp;
          Penalty 
          <button onclick="changePenalty('${name}', -1)">−</button>
          <span>${penalty}</span>
          <button onclick="changePenalty('${name}', 1)">+</button>
          &nbsp;&nbsp;
          <strong>Total $: ${calculateTotal(name)}</strong>
        </div>
      `;
    });

    renderEarnings();
  }

  function calculateTotal(player){
    // Calculate skin winnings/losses comparing strokes + handicap compensation

    // Find winner and margin first
    let winner = null;
    let winnerStroke = Infinity;

    players.forEach(p => {
      const st = scores[p][currentHole-1];
      if(st > 0 && st < winnerStroke){
        winnerStroke = st;
        winner = p;
      }
    });

    if(!winner) return 0;

    // Calculate handicap compensation relative to winner
    const comp = (handicaps[winner] - handicaps[player]) * 0.7;

    const diff = scores[player][currentHole-1] - winnerStroke + comp;

    let money = 0;
    if(diff > 0) {
      // Player lost this hole by diff strokes to winner: loses (diff +1) * skin
      money = -skinValue * (diff + 1);
    } else if(player === winner) {
      // winner gets skin + 5$ per stroke difference to others
      let totalWin = skinValue;
      players.forEach(p => {
        if(p !== winner){
          const d = scores[p][currentHole-1] - winnerStroke + ((handicaps[winner] - handicaps[p]) * 0.7);
          if(d > 0){
            totalWin += skinValue * d;
          }
        }
      });
      money = totalWin;
    } else {
      money = 0;
    }

    // Add bonus and penalty: each bonus + skinValue, each penalty - skinValue
    money += (bonusData[player][currentHole-1] * skinValue);
    money -= (penaltyData[player][currentHole-1] * skinValue);

    return money.toFixed(2);
  }

  function renderEarnings(){
    const list = document.getElementById('earningsList');
    list.innerHTML = '';
    players.forEach(p => {
      let total = 0;
      for(let h=0; h<18; h++){
        total += parseFloat(calculateTotalForHole(p, h+1));
      }
      list.innerHTML += `<li><strong>${p}:</strong> $${total.toFixed(2)}</li>`;
    });
  }

  // Helper to calculate total for any hole (used for total earnings)
  function calculateTotalForHole(player, hole){
    // Similar to calculateTotal but for arbitrary hole
    // Find winner for that hole
    let winner = null;
    let winnerStroke = Infinity;

    players.forEach(p => {
      const st = scores[p][hole-1];
      if(st > 0 && st < winnerStroke){
        winnerStroke = st;
        winner = p;
      }
    });

    if(!winner) return 0;

    const comp = (handicaps[winner] - handicaps[player]) * 0.7;
    const diff = scores[player][hole-1] - winnerStroke + comp;

    let money = 0;
    if(diff > 0) {
      money = -skinValue * (diff + 1);
    } else if(player === winner) {
      let totalWin = skinValue;
      players.forEach(p => {
        if(p !== winner){
          const d = scores[p][hole-1] - winnerStroke + ((handicaps[winner] - handicaps[p]) * 0.7);
          if(d > 0){
            totalWin += skinValue * d;
          }
        }
      });
      money = totalWin;
    } else {
      money = 0;
    }

    money += (bonusData[player][hole-1] * skinValue);
    money -= (penaltyData[player][hole-1] * skinValue);

    return money;
  }

  function changeScore(player, delta){
    let val = scores[player][currentHole-1];
    val = val + delta;
    if(val < 1) val = 1;
    scores[player][currentHole-1] = val;
    renderHole();
  }

  function changeBonus(player, delta){
    let val = bonusData[player][currentHole-1];
    val = val + delta;
    if(val < 0) val = 0;
    bonusData[player][currentHole-1] = val;
    renderHole();
  }

  function changePenalty(player, delta){
    let val = penaltyData[player][currentHole-1];
    val = val + delta;
    if(val < 0) val = 0;
    penaltyData[player][currentHole-1] = val;
    renderHole();
  }

  function nextHole(){
    if(currentHole < 18){
      currentHole++;
      renderHole();
    }
  }

  function prevHole(){
    if(currentHole > 1){
      currentHole--;
      renderHole();
    }
  }

</script>

</body>
</html>
