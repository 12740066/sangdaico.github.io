<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Golf Bet Calculator</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 900px; margin: 1rem auto; padding: 0 1rem; }
  h1 { text-align: center; }
  label { display: inline-block; width: 150px; }
  input[type=number] { width: 60px; text-align: center; }
  button { margin: 0 4px; }
  table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
  th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: center; }
  th { background: #eee; }
  .money-positive { color: green; font-weight: bold; }
  .money-negative { color: red; font-weight: bold; }
  .control-row { margin-bottom: 1rem; }
  .player-inputs > div { margin-bottom: 1rem; }
</style>
</head>
<body>

<h1>Golf Bet Calculator</h1>

<div class="control-row">
  <label>Number of Players:</label>
  <button id="players-decrease">-</button>
  <input type="number" id="numPlayers" value="4" min="2" max="10" readonly />
  <button id="players-increase">+</button>
</div>

<div class="control-row">
  <label>Skin Value ($):</label>
  <button id="skin-decrease">-</button>
  <input type="number" id="skinValue" value="5" min="1" max="100" readonly />
  <button id="skin-increase">+</button>
</div>

<button id="startGame">Start / Next Hole</button>
<span style="margin-left: 1rem;">Current Hole: <span id="holeNumber">1</span></span>

<div class="player-inputs"></div>

<table id="resultsTable" style="display:none;">
  <thead>
    <tr>
      <th>Player</th>
      <th>Strokes</th>
      <th>Bonus</th>
      <th>Penalty</th>
      <th>Money this hole</th>
      <th>Total Money</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
(() => {
  const maxPlayers = 10;
  let numPlayers = 4;
  let skinValue = 5;
  let holeNumber = 1;
  let players = [];
  let totalMoney = []; // accumulated total money per player

  const numPlayersInput = document.getElementById('numPlayers');
  const skinValueInput = document.getElementById('skinValue');
  const playersDecreaseBtn = document.getElementById('players-decrease');
  const playersIncreaseBtn = document.getElementById('players-increase');
  const skinDecreaseBtn = document.getElementById('skin-decrease');
  const skinIncreaseBtn = document.getElementById('skin-increase');
  const startGameBtn = document.getElementById('startGame');
  const playerInputsDiv = document.querySelector('.player-inputs');
  const resultsTable = document.getElementById('resultsTable');
  const resultsTbody = resultsTable.querySelector('tbody');
  const holeNumberSpan = document.getElementById('holeNumber');

  // Initialize or load from localStorage
  function loadState() {
    const saved = localStorage.getItem('golfBetState');
    if (saved) {
      try {
        const data = JSON.parse(saved);
        numPlayers = data.numPlayers || 4;
        skinValue = data.skinValue || 5;
        holeNumber = data.holeNumber || 1;
        players = data.players || [];
        totalMoney = data.totalMoney || Array(numPlayers).fill(0);
      } catch {
        resetState();
      }
    } else {
      resetState();
    }
  }

  function resetState() {
    players = [];
    totalMoney = [];
    for(let i=0; i<numPlayers; i++) {
      players.push({ name: `Player ${i+1}`, strokes: 0, bonus: 0, penalty: 0 });
      totalMoney.push(0);
    }
  }

  function saveState() {
    localStorage.setItem('golfBetState', JSON.stringify({
      numPlayers,
      skinValue,
      holeNumber,
      players,
      totalMoney
    }));
  }

  // Create player inputs UI
  function renderPlayerInputs() {
    playerInputsDiv.innerHTML = '';
    for(let i=0; i<numPlayers; i++) {
      if (!players[i]) players[i] = { name: `Player ${i+1}`, strokes: 0, bonus: 0, penalty: 0 };
      const p = players[i];
      const container = document.createElement('div');
      container.style.marginBottom = '10px';

      container.innerHTML = `
        <strong>${p.name}</strong>
        &nbsp;&nbsp; Strokes: 
          <button class="dec" data-type="strokes" data-index="${i}">-</button> 
          <span id="strokes-${i}">${p.strokes}</span> 
          <button class="inc" data-type="strokes" data-index="${i}">+</button> 

        &nbsp;&nbsp; Bonus: 
          <button class="dec" data-type="bonus" data-index="${i}">-</button> 
          <span id="bonus-${i}">${p.bonus}</span> 
          <button class="inc" data-type="bonus" data-index="${i}">+</button> 

        &nbsp;&nbsp; Penalty: 
          <button class="dec" data-type="penalty" data-index="${i}">-</button> 
          <span id="penalty-${i}">${p.penalty}</span> 
          <button class="inc" data-type="penalty" data-index="${i}">+</button> 
      `;

      playerInputsDiv.appendChild(container);
    }

    // Add event listeners for increment/decrement
    playerInputsDiv.querySelectorAll('button').forEach(btn => {
      btn.onclick = () => {
        const type = btn.dataset.type;
        const idx = parseInt(btn.dataset.index);
        if (btn.classList.contains('inc')) {
          players[idx][type]++;
        } else if (btn.classList.contains('dec')) {
          if (players[idx][type] > 0) players[idx][type]--;
        }
        updatePlayerDisplay(idx);
        calculateAndRenderResults();
        saveState();
      };
    });
  }

  // Update displayed number for one player input row
  function updatePlayerDisplay(idx) {
    document.getElementById(`strokes-${idx}`).textContent = players[idx].strokes;
    document.getElementById(`bonus-${idx}`).textContent = players[idx].bonus;
    document.getElementById(`penalty-${idx}`).textContent = players[idx].penalty;
  }

function calculateAndRenderResults() {
  resultsTbody.innerHTML = '';
  resultsTable.style.display = 'table';

  const holeMoney = Array(numPlayers).fill(0);

  // Pairwise stroke comparisons + hole wins
  for (let i = 0; i < numPlayers; i++) {
    for (let j = 0; j < numPlayers; j++) {
      if (i === j) continue;

      const diff = players[j].strokes - players[i].strokes;
      // Money based on stroke difference
      holeMoney[i] += diff * skinValue;

      // Extra +1 skin if player i wins the hole against j (less strokes)
      if (players[i].strokes < players[j].strokes) {
        holeMoney[i] += skinValue;
      }
    }
  }

  // Bonus & Penalty
  for (let i = 0; i < numPlayers; i++) {
    const bonusGain = players[i].bonus * skinValue * (numPlayers - 1);
    holeMoney[i] += bonusGain;
    for (let j = 0; j < numPlayers; j++) {
      if (j === i) continue;
      holeMoney[j] -= players[i].bonus * skinValue;
    }

    const penaltyLoss = players[i].penalty * skinValue * (numPlayers - 1);
    holeMoney[i] -= penaltyLoss;
    for (let j = 0; j < numPlayers; j++) {
      if (j === i) continue;
      holeMoney[j] += players[i].penalty * skinValue;
    }
  }

  for (let i = 0; i < numPlayers; i++) {
    totalMoney[i] += holeMoney[i];
  }

  // Render results table rows
  for (let i = 0; i < numPlayers; i++) {
    const tr = document.createElement('tr');
    const moneyThisHole = holeMoney[i];
    const total = totalMoney[i];
    tr.innerHTML = `
      <td>${players[i].name}</td>
      <td>${players[i].strokes}</td>
      <td>${players[i].bonus}</td>
      <td>${players[i].penalty}</td>
      <td class="${moneyThisHole >= 0 ? 'money-positive' : 'money-negative'}">$${moneyThisHole.toFixed(2)}</td>
      <td class="${total >= 0 ? 'money-positive' : 'money-negative'}">$${total.toFixed(2)}</td>
    `;
    resultsTbody.appendChild(tr);
  }
}

  // Reset inputs for next hole, keep total money and player names
  function nextHole() {
    holeNumber++;
    holeNumberSpan.textContent = holeNumber;
    players.forEach(p => {
      p.strokes = 0;
      p.bonus = 0;
      p.penalty = 0;
    });
    renderPlayerInputs();
    calculateAndRenderResults();
    saveState();
  }

  // Initialize and bind control buttons
  function bindControls() {
    playersDecreaseBtn.onclick = () => {
      if (numPlayers > 2) {
        numPlayers--;
        numPlayersInput.value = numPlayers;
        resetState();
        holeNumber = 1;
        holeNumberSpan.textContent = holeNumber;
        renderPlayerInputs();
        calculateAndRenderResults();
        saveState();
      }
    };
    playersIncreaseBtn.onclick = () => {
      if (numPlayers < maxPlayers) {
        numPlayers++;
        numPlayersInput.value = numPlayers;
        resetState();
        holeNumber = 1;
        holeNumberSpan.textContent = holeNumber;
        renderPlayerInputs();
        calculateAndRenderResults();
        saveState();
      }
    };
    skinDecreaseBtn.onclick = () => {
      if (skinValue > 1) {
        skinValue--;
        skinValueInput.value = skinValue;
        calculateAndRenderResults();
        saveState();
      }
    };
    skinIncreaseBtn.onclick = () => {
      if (skinValue < 100) {
        skinValue++;
        skinValueInput.value = skinValue;
        calculateAndRenderResults();
        saveState();
      }
    };
    startGameBtn.onclick = () => {
      nextHole();
    };
  }

  // On load
  function init() {
    loadState();
    numPlayersInput.value = numPlayers;
    skinValueInput.value = skinValue;
    holeNumberSpan.textContent = holeNumber;
    bindControls();
    renderPlayerInputs();
    calculateAndRenderResults();
  }

  init();

})();
</script>

</body>
</html>
